name: Set Admin Claims

on:
  workflow_dispatch: {}

jobs:
  set-claims:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 9

      - name: Install deps
        run: pnpm install --frozen-lockfile

      - name: Write Firebase admin credentials
        run: |
          mkdir -p secrets
          echo "$FIREBASE_ADMIN_CREDENTIALS_JSON" > secrets/firebase-admin.json
        env:
          FIREBASE_ADMIN_CREDENTIALS_JSON: ${{ secrets.FIREBASE_ADMIN_CREDENTIALS_JSON }}

      - name: Run claim setter
        env:
          FIREBASE_ADMIN_CREDENTIALS_PATH: secrets/firebase-admin.json
          FIREBASE_ADMIN_PROJECT_ID: ${{ secrets.FIREBASE_ADMIN_PROJECT_ID }}
        run: pnpm tsx scripts/set-admin-claims.ts
